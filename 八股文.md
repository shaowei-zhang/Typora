# å…«è‚¡æ–‡

##### 1ã€Javaç±»åœ¨åˆ›å»ºä¼šé»˜è®¤é›†æˆ`java.lang.Object`çš„å‡ ä¸ªæ–¹æ³•

| æ–¹æ³•å               | ä½œç”¨è¯´æ˜                                          |      |
| -------------------- | :------------------------------------------------ | ---- |
| `toString()`         | è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼ˆé»˜è®¤æ˜¯ç±»å+@+å“ˆå¸Œå€¼ï¼‰       |      |
| `equals(Object obj)` | æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦â€œç›¸ç­‰â€ï¼ˆé»˜è®¤æ˜¯æ¯”è¾ƒåœ°å€ï¼‰          |      |
| `hashCode()`         | è¿”å›å¯¹è±¡çš„å“ˆå¸Œå€¼ï¼ˆä¸ equals é…åˆä½¿ç”¨ï¼‰            |      |
| `clone()`            | åˆ›å»ºå¹¶è¿”å›å¯¹è±¡çš„å‰¯æœ¬ï¼ˆå¿…é¡»å®ç° `Cloneable` æ¥å£ï¼‰ |      |
| `getClass()`         | è¿”å›è¿è¡Œæ—¶ç±»å¯¹è±¡ï¼ˆClass ç±»å‹ï¼‰                    |      |
| `finalize()`         | å¯¹è±¡è¢«åƒåœ¾å›æ”¶å‰è°ƒç”¨ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰                |      |
| `notify()`           | å”¤é†’ç­‰å¾…çº¿ç¨‹ï¼ˆç”¨äºçº¿ç¨‹é€šä¿¡ï¼‰                      |      |
| `notifyAll()`        | å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼ˆç”¨äºçº¿ç¨‹é€šä¿¡ï¼‰                  |      |
| `wait()`             | å½“å‰çº¿ç¨‹ç­‰å¾…ï¼ˆç”¨äºçº¿ç¨‹é€šä¿¡ï¼‰                      |      |



##### 2ã€ `protected` æ–¹æ³•çš„è®¿é—®æƒé™

ä¸€ä¸ªè¢« `protected` ä¿®é¥°çš„æ–¹æ³•å…·æœ‰ä»¥ä¸‹è®¿é—®æƒé™ï¼š

| å¯ä»¥è®¿é—®çš„èŒƒå›´         | æ˜¯å¦å…è®¸è®¿é—® |
| ---------------------- | ------------ |
| åŒä¸€ä¸ªç±»ä¸­             | âœ… æ˜¯         |
| åŒä¸€ä¸ªåŒ…ä¸­çš„å…¶ä»–ç±»     | âœ… æ˜¯         |
| ä¸åŒåŒ…ä¸­çš„å­ç±»ï¼ˆç»§æ‰¿ï¼‰ | âœ… æ˜¯         |
| ä¸åŒåŒ…ä¸­çš„éå­ç±»       | âŒ å¦         |



| ä¿®é¥°ç¬¦       | åŒç±» | åŒåŒ… | å­ç±»ï¼ˆè·¨åŒ…ï¼‰ | å…¶ä»–åŒ… |
| ------------ | ---- | ---- | ------------ | ------ |
| `private`    | âœ…    | âŒ    | âŒ            | âŒ      |
| *é»˜è®¤*ï¼ˆåŒ…ï¼‰ | âœ…    | âœ…    | âŒ            | âŒ      |
| `protected`  | âœ…    | âœ…    | âœ…            | âŒ      |
| `public`     | âœ…    | âœ…    | âœ…            | âœ…      |





##### 3ã€æµ…æ‹·è´å’Œæ·±æ‹·è´

>æµ…æ‹·è´

- æ‹·è´å¯¹è±¡çš„**åŸºæœ¬ç±»å‹å­—æ®µå€¼**ï¼Œä½†å¯¹äºå¼•ç”¨ç±»å‹å­—æ®µï¼Œä»…ä»…**å¤åˆ¶å¼•ç”¨åœ°å€**ï¼Œå¹¶ä¸å¤åˆ¶å¯¹è±¡æœ¬èº«ã€‚
- ä½¿ç”¨ `clone()` æ–¹æ³•å®ç°ï¼Œç±»éœ€è¦å®ç° `Cloneable` æ¥å£

```java
class Address {
    String city;

    Address(String city) {
        this.city = city;
    }
}

class Person implements Cloneable {
    String name;
    Address address;

    Person(String name, Address address) {
        this.name = name;
        this.address = address;
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone(); // æµ…æ‹·è´
    }
}

public class Main {
    public static void main(String[] args) throws CloneNotSupportedException {
        Address address = new Address("Beijing");
        Person p1 = new Person("Tom", address);
        Person p2 = (Person) p1.clone();

        p2.address.city = "Shanghai";

        System.out.println(p1.address.city);  // è¾“å‡ºï¼šShanghaiï¼ŒåŸå¯¹è±¡è¢«å½±å“
    }
}

```



>æ·±æ‹·è´

- ä¸ä»…å¤åˆ¶å½“å‰å¯¹è±¡ï¼Œè¿˜ä¼š**é€’å½’å¤åˆ¶å¼•ç”¨çš„å¯¹è±¡**ã€‚
- é€šå¸¸éœ€è¦æ‰‹åŠ¨å®ç° clone æ–¹æ³•ï¼Œæˆ–è€…ä½¿ç”¨åºåˆ—åŒ–ã€ä¸‰æ–¹åº“ï¼ˆå¦‚ Apache Commons Langï¼‰ã€‚

```java
class Address implements Cloneable {
    String city;

    Address(String city) {
        this.city = city;
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        return new Address(this.city);
    }
}

class Person implements Cloneable {
    String name;
    Address address;

    Person(String name, Address address) {
        this.name = name;
        this.address = address;
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        Person cloned = (Person) super.clone();
        cloned.address = (Address) address.clone(); // æ‰‹åŠ¨æ·±æ‹·è´å¼•ç”¨å­—æ®µ
        return cloned;
    }
}

public class Main {
    public static void main(String[] args) throws CloneNotSupportedException {
        Address address = new Address("Beijing");
        Person p1 = new Person("Tom", address);
        Person p2 = (Person) p1.clone();

        p2.address.city = "Shanghai";

        System.out.println(p1.address.city);  // è¾“å‡ºï¼šBeijingï¼ŒåŸå¯¹è±¡æœªè¢«å½±å“
    }
}

```

| ç‰¹æ€§         | æµ…æ‹·è´                   | æ·±æ‹·è´                            |
| ------------ | ------------------------ | --------------------------------- |
| å¼•ç”¨ç±»å‹å­—æ®µ | æ‹·è´å¼•ç”¨åœ°å€ï¼ˆå…±äº«å¯¹è±¡ï¼‰ | é€’å½’å¤åˆ¶ï¼Œå®Œå…¨ç‹¬ç«‹                |
| å®ç°æ–¹å¼     | `super.clone()`          | æ‰‹åŠ¨é€’å½’ clone æˆ–ä½¿ç”¨åºåˆ—åŒ–ç­‰å·¥å…· |
| å®‰å…¨æ€§       | å®¹æ˜“å‡ºé”™ï¼ŒåŸå¯¹è±¡å¯èƒ½è¢«æ”¹ | å®‰å…¨ï¼Œå‰¯æœ¬äº’ä¸å½±å“                |



##### 4ã€åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»

åŸºæœ¬æ•°æ®ç±»å‹éƒ½æœ‰å¯¹åº”çš„å¼•ç”¨ç±»å‹ï¼Œç§°ä¸ºâ€œåŒ…è£…ç±»â€ï¼Œå®ƒä»¬ä½äº `java.lang` åŒ…ä¸­ï¼š

| åŸºæœ¬ç±»å‹  | åŒ…è£…ç±»      |
| --------- | ----------- |
| `byte`    | `Byte`      |
| `short`   | `Short`     |
| `int`     | `Integer`   |
| `long`    | `Long`      |
| `float`   | `Float`     |
| `double`  | `Double`    |
| `char`    | `Character` |
| `boolean` | `Boolean`   |



>è‡ªåŠ¨è£…ç®±

ğŸ§Š ä¸€å¥è¯å®šä¹‰ï¼š

- **è‡ªåŠ¨è£…ç®±ï¼ˆAutoboxingï¼‰**ï¼šJava è‡ªåŠ¨æŠŠ **åŸºæœ¬ç±»å‹ â†’ åŒ…è£…ç±»å¯¹è±¡**ã€‚
- **è‡ªåŠ¨æ‹†ç®±ï¼ˆUnboxingï¼‰**ï¼šJava è‡ªåŠ¨æŠŠ **åŒ…è£…ç±»å¯¹è±¡ â†’ åŸºæœ¬ç±»å‹å€¼**ã€‚

**åº”ç”¨åœºæ™¯**ï¼š

1ã€é›†åˆçš„å­˜å–å€¼

```java
List<Integer> list = new ArrayList<>();
list.add(5);  // è‡ªåŠ¨è£…ç®±ï¼š5 â†’ Integer.valueOf(5)
int x = list.get(0); // è‡ªåŠ¨æ‹†ç®±ï¼šInteger â†’ int
```

2ã€æ¯”è¾ƒ

```
int a = 1;
Integer a2 = 1;

System.out.println(a == a2);        // true
System.out.println(a2.equals(a));   // true

```

| è¡¨è¾¾å¼         | è§£é‡Šé€»è¾‘                                    | ç»“æœ     |
| -------------- | ------------------------------------------- | -------- |
| `a == a2`      | `a2` è‡ªåŠ¨æ‹†ç®±ä¸º `int`ï¼Œæ¯”è¾ƒå€¼ `1 == 1`      | âœ… `true` |
| `a2.equals(a)` | `a` è‡ªåŠ¨è£…ç®±ä¸º `Integer`ï¼Œå†æ¯”è¾ƒå€¼ `1 == 1` | âœ… `true` |

â— å¸¸è§å‘ç‚¹å’Œé¢è¯•é¢˜

ğŸ•³ï¸ 1. è‡ªåŠ¨æ‹†ç®± + null

```java
Integer a = null;
int b = a;  // âŒ NullPointerExceptionï¼
```

æ‹†ç®±æ—¶ä¼šè°ƒç”¨ `a.intValue()`ï¼Œè€Œæ­¤æ—¶ `a == null`ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ã€‚

ğŸ•³ï¸ 2. è¿ç®—ä¼šè§¦å‘æ‹†ç®±

```java
Integer a = 10;
Integer b = 20;
System.out.println(a + b);  // è‡ªåŠ¨æ‹†ç®±ï¼ša.intValue() + b.intValue() â†’ int
```



æ³¨æ„ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼

```java
        Integer x = 127;
        Integer y = 127;
        System.out.println(x == y);      // true
        System.out.println(x.equals(y)); // true

		Integer x = 128;
		Integer y = 128;
		System.out.println(x == y);      // false
		System.out.println(x.equals(y)); // true

```

Java çš„ **æ•´æ•°ç¼“å­˜æ± æœºåˆ¶ï¼ˆ-128 åˆ° 127ï¼‰**

**ä¸ºä»€ä¹ˆ `127 == 127` æ˜¯ `true`ï¼Œè€Œ `128 == 128` æ˜¯ `false`ï¼Ÿ**

è¿™æ˜¯å› ä¸º Java ä½¿ç”¨äº†ä¸€ä¸ªç¼“å­˜æ± ï¼ˆ`IntegerCache` ç±»ï¼‰ï¼š

ğŸ”§ æºç æ¥è‡ª `Integer.java`ï¼š

```java
private static class IntegerCache {
    static final int low = -128;
    static final int high = 127;
    static final Integer[] cache;

    static {
        cache = new Integer[(high - low) + 1];
        for (int i = 0; i < cache.length; i++) {
            cache[i] = new Integer(i - 128);
        }
    }
}
```

- æ‰€æœ‰åœ¨ `-128 ~ 127` èŒƒå›´å†…çš„ `Integer.valueOf(x)` éƒ½ä»ç¼“å­˜ä¸­å–å¯¹è±¡ã€‚

- æ‰€ä»¥ï¼š

  ```
  Integer a = 127;  // å®é™…ä¸Šè°ƒç”¨ Integer.valueOf(127)
  Integer b = 127;  // å¤ç”¨ç¼“å­˜ä¸­åŒä¸€ä¸ªå¯¹è±¡
  ```

- ä½†ï¼š

  ```
  Integer x = 128;  // è¶…å‡ºç¼“å­˜èŒƒå›´ï¼Œä¼š new Integer(128)
  Integer y = 128;  // åˆåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡
  ```

------

ğŸ§  é¢è¯•é—®æ³•å¸¸è§é™·é˜±

```java
javaå¤åˆ¶ç¼–è¾‘Integer a = 100;
Integer b = 100;
Integer c = 200;
Integer d = 200;

System.out.println(a == b); // true
System.out.println(c == d); // false
```

âš ï¸ å› ä¸º `200` ä¸åœ¨ç¼“å­˜èŒƒå›´å†…ã€‚

------

ğŸ’¡ é¢å¤–çŸ¥è¯†ï¼šç¼“å­˜èŒƒå›´å¯ä»¥ä¿®æ”¹å—ï¼Ÿ

å¯ä»¥çš„ï¼åœ¨ JVM å¯åŠ¨æ—¶è®¾ç½®å‚æ•°å¯ä»¥æ‰©å±•ç¼“å­˜èŒƒå›´ï¼š

```sh
-XX:AutoBoxCacheMax=256
```

è®¾ç½®å `Integer.valueOf(200)` ä¹Ÿå¯èƒ½å¤ç”¨å¯¹è±¡ï¼Œä½†**éœ€è¦è‡ªå·±æ§åˆ¶ JVM å‚æ•°**ï¼Œé»˜è®¤ä»ç„¶æ˜¯ `-128 ~ 127`





##### 5ã€è§£æä½¿ç”¨æœ€å¤šçš„å¼•ç”¨æ•°æ®ç±»å‹`String`

Java ç‰¹åˆ«ä¼˜åŒ–äº† `String`ï¼š

- å­—é¢é‡ï¼ˆå¦‚ `"hello"`ï¼‰æ˜¯è‡ªåŠ¨åˆ›å»ºçš„ `String` å¯¹è±¡ï¼Œå­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼›
- `String` æ˜¯ä¸å¯å˜çš„ï¼ˆ`final` ç±» + å†…éƒ¨å€¼ä¸èƒ½ä¿®æ”¹ï¼‰ï¼Œè¡Œä¸ºç±»ä¼¼åŸºæœ¬ç±»å‹ï¼›
- ç¼–è¯‘å™¨å¯¹ `+` æ‹¼æ¥ã€æ¯”è¾ƒç­‰æ“ä½œåšäº†ä¼˜åŒ–ï¼Œè®©ä½ **ç”¨å¾—åƒåŸºæœ¬ç±»å‹ä¸€æ ·è½»æ¾**ã€‚